<!DOCTYPE html>
<html>
<head>
  <title>Student Tracking Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      display: flex;
      min-height: 100vh;
    }
    #sidebar {
      width: 250px;
      transition: all 0.3s;
    }
    #sidebar.collapsed {
      width: 70px;
    }
    #sidebar.collapsed .nav-link span {
      display: none;
    }
    #main-content {
      flex: 1;
      padding: 20px;
    }
    .sidebar-toggle {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar" class="bg-dark text-white p-3">
    <div class="sidebar-toggle text-end mb-3">
      <span class="btn btn-sm btn-outline-light" onclick="toggleSidebar()">â˜°</span>
    </div>
    <h5 class="text-white">Admin</h5>
    <nav class="nav flex-column">
      <!-- <a class="nav-link text-white" href="{{ url_for('admin.manage_users') }}">ðŸ‘¥ Manage Users</a> -->
      <a class="nav-link text-white" href="{{ url_for('admin.manage_users') }}">ðŸ‘¥ <span>Manage Users</span></a>
      <a class="nav-link text-white" href="{{ url_for('main.register') }}">âž• <span>Register Student</span></a>
      <a class="nav-link text-white" href="{{ url_for('main.register_faculty') }}">âž• <span>Register faculty</span></a>
      <a class="nav-link text-white" href="{{ url_for('main.students') }}">ðŸ“‹ <span>View Students</span></a>
      <a class="nav-link text-white" href="{{ url_for('main.milestones') }}">ðŸ“Œ <span>View Milestones</span></a>
    </nav>
  </div>

  <!-- Main Content -->
  <div id="main-content">
    {% if user.is_authenticated %}
      <div class="alert alert-info text-center">
        Welcome, <strong>{{ user.full_name }}</strong> ({{ user.role }})
      </div>
    {% endif %}

    <h1 class="mb-4">ðŸ“Š Student Research Tracker Dashboard</h1>

    <!-- Summary cards -->
    <div class="row text-center mb-4">
      <div class="col-md-3"><div class="card p-3"><h5>Total Students</h5><p>{{ stats.total_students }}</p></div></div>
      <div class="col-md-3"><div class="card p-3"><h5>Total Supervisors</h5><p>{{ stats.total_supervisors }}</p></div></div>
      <div class="col-md-3"><div class="card p-3"><h5>Unassigned Students</h5><p>{{ stats.unassigned_students }}</p></div></div>
      <div class="col-md-3"><div class="card p-3"><h5>Avg Completion</h5><p>{{ stats.average_completion }}%</p></div></div>
    </div>

    <!-- Charts -->
    <div class="row">
      <div class="col-md-6">
        <h5>ðŸŽ¯ Completion Rate</h5>
        <canvas id="completionChart"></canvas>
      </div>
      <div class="col-md-6">
        <h5>ðŸ“… Yearly Intake</h5>
        <canvas id="intakeChart"></canvas>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const completedStudents = {{ stats.completed_students | tojson }};
    const totalStudents = {{ stats.total_students | tojson }};
    const yearOfIntakes = {{ stats.year_of_intakes | tojson }};
    const intakeCounts = {{ stats.intake_counts | tojson }};

    const completionCtx = document.getElementById('completionChart');
    new Chart(completionCtx, {
      type: 'pie',
      data: {
        labels: ['Completed', 'In Progress'],
        datasets: [{
          data: [completedStudents, totalStudents - completedStudents],
          backgroundColor: ['#28a745', '#ffc107'],
        }]
      }
    });

    const intakeCtx = document.getElementById('intakeChart');
    new Chart(intakeCtx, {
      type: 'bar',
      data: {
        labels: yearOfIntakes,
        datasets: [{
          label: 'Students',
          data: intakeCounts,
          backgroundColor: '#007bff'
        }]
      }
    });

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('collapsed');
    }
  </script>
</body>
</html>
