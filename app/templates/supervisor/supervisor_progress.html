{% extends 'layouts/supervisor_layout.html' %}

{% block title %}Review Student Progress{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- Header and Back Button -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>🧑‍🎓 Reviewing: <span class="text-primary">{{ student.full_name }}</span></h3>
    <a href="{{ url_for('main.supervisor_dashboard') }}" class="btn btn-outline-secondary btn-sm">← Back to Dashboard</a>
  </div>

  <!-- Inline Student Profile Summary -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-3">
      <h6 class="card-title mb-3 text-muted">📄 Student Profile Summary</h6>
      <div class="row small">
        <div class="col-md-4 mb-2">
          <strong>Program:</strong> {{ student.program or 'N/A' }}
        </div>
        <div class="col-md-4 mb-2">
          <strong>Year of Intake:</strong> {{ student.year_of_intake or 'N/A' }}
        </div>
        <div class="col-md-4 mb-2">
          <strong>Registration Number:</strong> {{ student.registration_number or 'N/A' }}
        </div>
        <div class="col-12 mt-2">
          <strong>Research Topic:</strong> 
          {{ student.research_topic or 'Not yet provided' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Milestone Review Form -->
  <form method="POST">
    {% for item in progress_data %}
    <div class="card my-4 shadow-sm border-0">
      <div class="card-header bg-light">
        <strong>{{ loop.index }}. {{ item.milestone.name }}</strong>
      </div>
      <ul class="list-group list-group-flush">
        {% for entry in item.subtasks %}
        <li class="list-group-item">
          <div class="row align-items-center">
            <div class="col-md-6">
              <div><strong>{{ entry.subtask.name }}</strong></div>
              {% if entry.comment %}
              <small class="text-muted">💬 Student Note: {{ entry.comment }}</small>
              {% endif %}
            </div>
            <div class="col-md-3">
              <span class="badge 
                  {% if entry.status == 'completed' %}bg-success
                  {% elif entry.status == 'in_progress' %}bg-warning text-dark
                  {% else %}bg-secondary
                  {% endif %}">
                {{ entry.status.replace('_', ' ').capitalize() }}
              </span>
            </div>
            <div class="col-md-3">
              <select name="subtask_{{ entry.subtask.id }}" class="form-select form-select-sm">
                <option value="pending" {% if entry.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="in_progress" {% if entry.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="completed" {% if entry.status == 'completed' %}selected{% endif %}>Completed</option>
              </select>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}

    <div class="text-end">
      <button type="submit" class="btn btn-success">
        💾 Save Supervisor Review
      </button>
    </div>
  </form>
</div>
{% endblock %}
